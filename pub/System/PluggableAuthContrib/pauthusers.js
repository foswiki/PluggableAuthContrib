"use strict";!function(t){var e,a={};function o(e,o){var n=this;n.elem=t(e),n.opts=t.extend(!0,a,n.elem.data(),o),n.init()}o.prototype.init=function(){var e=this;e.sidebar=t(".pauthSideBar"),e.addUserButton=e.elem.find(".pauthAddUser"),e.addGroupButton=e.elem.find(".pauthAddGroup"),e.updateButton=e.elem.find(".pauthUpdateUser"),e.groupsButton=e.elem.find(".pauthGroups"),e.passwordButton=e.elem.find(".pauthChangePassword"),e.resetButton=e.elem.find(".pauthResetPassword"),e.deleteButton=e.elem.find(".pauthDeleteUser"),e.activateButton=e.elem.find(".pauthActivateUser"),e.deactivateButton=e.elem.find(".pauthDeactivateUser"),e.table=e.elem.find(".pauthUsersTable table"),e.dataTable=e.table.data("dt"),e.selectionElem=e.elem.find("input[name=id]"),e.dataTable.on("dblclick","tr",(function(){var a=e.dataTable.row(this).data();if(a)return foswiki.loadTemplate({name:"System.PluggableAuthUsers",expand:"pauth::edituserdialog",uid:a.id.raw}).done((function(e){var a=t(e.expand);t("body").append(a)})),!1})),e.dataTable.on("select deselect",(function(){var t=e.getSelection();0===t.length?(e.updateButton.addClass("jqButtonDisabled"),e.passwordButton.addClass("jqButtonDisabled"),e.deleteButton.addClass("jqButtonDisabled"),e.activateButton.addClass("jqButtonDisabled"),e.deactivateButton.addClass("jqButtonDisabled"),e.resetButton.addClass("jqButtonDisabled"),e.groupsButton.addClass("jqButtonDisabled")):1===t.length?(e.updateButton.removeClass("jqButtonDisabled"),e.passwordButton.removeClass("jqButtonDisabled"),e.deleteButton.removeClass("jqButtonDisabled"),e.activateButton.removeClass("jqButtonDisabled"),e.deactivateButton.removeClass("jqButtonDisabled"),e.resetButton.removeClass("jqButtonDisabled"),e.groupsButton.removeClass("jqButtonDisabled")):(e.updateButton.addClass("jqButtonDisabled"),e.groupsButton.addClass("jqButtonDisabled"),e.passwordButton.addClass("jqButtonDisabled"),e.deleteButton.removeClass("jqButtonDisabled"),e.activateButton.removeClass("jqButtonDisabled"),e.deactivateButton.removeClass("jqButtonDisabled"),e.resetButton.removeClass("jqButtonDisabled"))})),e.dataTable.on("preXhr.dt",(function(t,a,o){var n=e.getSelectedGroup();n&&(o.query+=" and m.gid='"+n+"'")})),t(".pauthSideBar .selected .pauthGroupLink").each((function(){var e=t(this).text().trim();t(".pauthGroupFilter").html("( "+e+" )")}))},o.prototype.getSelection=function(){var t=this.selectionElem.val();return""===t?[]:t.split(/\s*,\s*/)},o.prototype.clearSelection=function(){this.dataTable.rows().deselect(),this.selectionElem.val("")},o.prototype.getSelectedGroup=function(){return this.sidebar.find(".selected .pauthGroupLink").data("gid")},o.prototype.reloadSideBar=function(){this.sidebar.trigger("refresh",{selected:this.getSelectedGroup()})},o.prototype.reloadTable=function(){this.clearSelection(),this.dataTable.ajax.reload()},t(".pauthDialog").livequery((function(){var a=t(this).find("form:first"),o=a.data("reloadSidebar"),n=t(this);a.on("beforeSubmit",(function(){n.dialog("destroy")})),a.on("success",(function(a,n,s){t.pnotify({type:"success",title:"Success",delay:5e3,text:s.result}),e.reloadTable(),o&&e.reloadSideBar()})),a.on("complete",(function(){n.remove()}))})),t(document).on("click",".pauthGroupLink",(function(){var a=t(this),o=a.parent();return t(".pauthSideBar .selected").removeClass("selected"),o.addClass("selected"),t(".pauthGroupFilter").html("( "+a.text().trim()+" )"),e.reloadTable(),!1})),t(document).on("click",".pauthButton",(function(){var a=t(this),o=t.extend({name:"System.PluggableAuthUsers",uid:e.getSelection().join(", ")},a.data());return o.expand=o.dialog,delete o.dialog,a.is(".jqButtonDisabled")||(a.parent().block({message:null}),foswiki.loadTemplate(o).done((function(e){var o=t(e.expand);t("body").append(o),a.parent().unblock()}))),!1})),t((function(){t(".pauthUsers").livequery((function(){e=new o(this)})),t(".pauthProviderFilter").livequery((function(){var e=t(this),a=e.prev(),o=e.data(),n=t(o.target);a.on("afterClose.twisty",(function(){e.data("val",e.val()),e.val("").trigger("keyup")})).on("beforeOpen.twisty",(function(){var t=e.data("val");void 0!==t&&(e.val(t).data("val",void 0),e.trigger("keyup"))})).on("afterOpen.twisty",(function(){e.focus()})),e.on("keyup",(function(){var a,o=e.val();""!==o?(a=new RegExp(o,"i"),n.children().each((function(){var e=t(this),o=e.text();a.test(o)?e.show():e.hide()}))):n.children().show()}))}))}))}(jQuery);
